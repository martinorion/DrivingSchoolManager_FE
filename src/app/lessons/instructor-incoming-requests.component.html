<div class="page">
  <div class="alerts">
    @if (error()) {
      <div class="error">{{ error() }}</div>
    }
    @if (success()) {
      <div class="success">{{ success() }}</div>
    }
  </div>

  <div class="toolbar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Hľadať</mat-label>
      <input matInput type="search" [value]="searchTerm()" (input)="onSearch($any($event.target).value)"  placeholder="ID, dátum, status, poznámka" />
      @if (searchTerm()) { <button matSuffix mat-icon-button aria-label="Vyčistiť" (click)="onSearch('')">
        <mat-icon>close</mat-icon>
      </button> }
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  @if (loading()) {
    <div>Načítavam...</div>
  }
  @if (!loading() && ordered().length === 0) {
    <div>Žiadne žiadosti.</div>
  }

  @for (r of ordered(); track r.id) {
    <div class="item">
      <div class="row">
        <div>
          <strong>{{ formatDateTime(r.start) }}</strong> - <strong>{{ formatDateTime(r.end) }}</strong>
        </div>
        <div>Meno študenta: {{r.studentFullName}}</div>
        <div>
          Status:
          <span
            class="status-badge"
            [class.status-rejected]="r.status === 'ZAMIETNUTÉ'"
            [class.status-approved]="r.status === 'SCHVÁLENE'"
            [class.status-pending]="!r.status || r.status === 'V PROCESE'"
          >
            {{ r.status || 'V PROCESE' }}
          </span>
        </div>
      </div>
      @if (r.note) {
        <div class="row small">Poznámka: {{ r.note }}</div>
      }

      <div class="actions">
        <button class="btn btn-primary" mat-raised-button (click)="approve(r)" [disabled]="r.status === 'SCHVÁLENE'">Schváliť</button>
        <button mat-stroked-button color="warn" (click)="reject(r)" [disabled]="r.status === 'ZAMIETNUTÉ'">Zamietnuť</button>
      </div>
    </div>
  }
</div>
