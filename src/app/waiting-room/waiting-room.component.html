<section class="container">
  @if (error()) {<div class="alert alert--error">{{ error() }}</div>}
  @if (success()) {<div class="alert alert--success">{{ success() }}</div>}

  @if (loading()) {<div>Načítavam...</div>} @else {
    @if (isStudent()) {
      @if (myWaiting()) {
        <div class="full-center">
          <mat-card class="waiting-card">
            <mat-card-header>
              <mat-card-title>Vitajte, študent</mat-card-title>
              <mat-card-subtitle>Ste v čakárni organizácie</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p class="mb-8"><span class="waiting-icon" aria-hidden="true">⏳</span>Čakáte, kým vás nepotvrdí inštruktor v <span class="underline">{{ orgNameForMyWaiting() }}</span>.</p>
            </mat-card-content>
            <mat-card-actions>
              <button mat-raised-button color="warn" (click)="cancelStudentsRequest()">Zrušiť žiadosť</button>
            </mat-card-actions>
          </mat-card>
        </div>
      } @else {
        <div class="full-center">
          <mat-card class="waiting-card">
            <mat-card-title>Nemáte žiadne otvorené žiadosti.</mat-card-title>
          </mat-card>
        </div>
      }
    }

    @if (isInstructor()) {
      @if (hasOrg() === false) {
        <div class="alert alert--info">Na zobrazenie čakárne musíte mať vytvorenú organizáciu.</div>
      } @else {
        <div class="org-columns">
          <mat-card>
            <mat-card-header>
              <mat-card-title>Študenti čakajúci na schválenie</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Hľadať študenta</mat-label>
                <input matInput [value]="studentsQuery()" (input)="onStudentsQueryInput($event)">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>

              <mat-list class="student-list">
                @for (s of pagedStudents(); track s.id) {
                  <mat-list-item>
                    <div class="item-content">
                      <span class="name">{{ s.firstName || '' }} {{ s.surname || '' }}</span>
                      <span class="spacer"></span>
                      <div class="buttons">
                        <button mat-icon-button class="accept" (click)="approve(s)">
                          <mat-icon>person_add</mat-icon>
                        </button>
                        <button mat-icon-button class="reject" (click)="reject(s)">
                          <mat-icon>delete</mat-icon>

                        </button>
                      </div>
                    </div>
                  </mat-list-item>
                }
              </mat-list>
            </mat-card-content>
            <mat-card-actions class="card-actions">
              <mat-paginator [length]="filteredStudents().length" [pageSize]="pageSize" [pageIndex]="studentsPageIndex()" [pageSizeOptions]="[pageSize]" (page)="onStudentsPage($event)"></mat-paginator>
            </mat-card-actions>
          </mat-card>

          <mat-card>
            <mat-card-header>
              <mat-card-title>Inštruktori čakajúci na schválenie</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Hľadať inštruktora</mat-label>
                <input matInput [value]="instructorsQuery()" (input)="onInstructorsQueryInput($event)">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>

              <mat-list class="instructor-list">
                @for (r of pagedInstructorRequests(); track r.id) {
                  <mat-list-item>
                    <div class="item-content">
                      <span class="name">{{ r.firstName }} {{ r.surname }}</span>
                      <span class="spacer"></span>
                      <div class="buttons">
                        <button mat-icon-button class="accept" (click)="approveInstructor(r)">
                          <mat-icon>person_add</mat-icon>

                        </button>
                        <button mat-icon-button class="reject" (click)="removeInstructorRequest(r)">
                          <mat-icon>delete</mat-icon>

                        </button>
                      </div>
                    </div>
                  </mat-list-item>
                }
              </mat-list>
            </mat-card-content>
            <mat-card-actions class="card-actions">
              <mat-paginator [length]="filteredInstructorRequests().length" [pageSize]="pageSize" [pageIndex]="instructorsPageIndex()" [pageSizeOptions]="[pageSize]" (page)="onInstructorsPage($event)"></mat-paginator>
            </mat-card-actions>
          </mat-card>
        </div>
      }
    }
  }
</section>
