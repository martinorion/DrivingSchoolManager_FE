<div class="container">
  <mat-card class="groups-card">
    <h2>Moje skupiny</h2>
    @if (!loadingGroups()) {
      <div class="groups-list">
        @for (g of groups(); track g.id) {
          <button mat-stroked-button color="primary" (click)="selectGroup(g.id!)" [disabled]="selectedGroupId()===g.id">
            <mat-icon>groups</mat-icon>
            <span>{{ g.name }}</span>
          </button>
        } @empty {
          <div class="muted">Žiadne skupiny.</div>
        }
      </div>
    } @else {
      <div class="loading-row"><mat-spinner diameter="24"></mat-spinner> Načítavam skupiny…</div>
    }
  </mat-card>

  @if (selectedGroupId()) {
    <mat-card class="announcements-card">
      <div class="header">
        <h2>Oznámenia</h2>
        <span class="flex-spacer"></span>
        <div class="muted">Skupina: {{ selectedGroupName() || '—' }}</div>
      </div>

      @if (canPost()) {
        <form [formGroup]="announceForm" (ngSubmit)="submitAnnouncement()">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Nadpis</mat-label>
            <input matInput formControlName="title" maxlength="100" placeholder="Krátky nadpis" />
            <mat-hint align="end">Max 100 znakov</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>Správa</mat-label>
            <textarea matInput formControlName="message" rows="3" placeholder="Text oznámenia"></textarea>
            <mat-hint align="end">Max 1000 znakov</mat-hint>
          </mat-form-field>
          <button mat-raised-button class="btn btn-primary" type="submit" [disabled]="announceForm.invalid || creating()">
            <mat-icon>send</mat-icon>
            Pridať oznámenie
          </button>
        </form>
      }

      @if (!loadingAnnouncements()) {
        <div class="list">
          @if (announcements().length > 0) {
            <mat-list>
              @for (a of announcements(); track a.id ?? $index) {
                <mat-list-item>
                  <div matListItemTitle>{{ a.title}}<span class="muted"> • {{ a.createdAt | date:'dd.MM.yyyy HH:mm' }}</span>
                  </div>
                  <div matListItemLine class="message">{{ a.message }}</div>
                  <div matListItemLine class="muted">Autor: INŠTRUCTOR</div>
                </mat-list-item>
              }
            </mat-list>
          } @else {
            <div class="muted">Zatiaľ žiadne oznámenia.</div>
          }
          <mat-paginator [length]="totalAnnouncements()" [pageIndex]="pageIndex()" [pageSize]="pageSize" (page)="onPage($event)"></mat-paginator>
        </div>
      } @else {
        <div class="loading-row"><mat-spinner diameter="24"></mat-spinner> Načítavam oznámenia…</div>
      }

    </mat-card>
  } @else {
    <mat-card class="announcements-card">
      <div class="muted">Vyberte skupinu pre zobrazenie oznámení.</div>
    </mat-card>
  }

  <div class="messages">
    @if (error()) { <div class="error">{{ error() }}</div> }
    @if (success()) { <div class="success">{{ success() }}</div> }
  </div>
</div>

